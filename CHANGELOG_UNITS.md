# 🔄 更新日誌：事業單位功能

## 📅 2025-11-03 - v2.1.0

### ✨ 新增功能

#### 1. 事業單位從 Google Sheets 載入

**之前**：事業單位下拉選單是空的，沒有選項

**現在**：
- ✅ 從 Google Sheets「事業單位」工作表自動載入
- ✅ 下拉選單會顯示所有事業單位
- ✅ 新增「🔄」重新載入按鈕

#### 2. 事業單位管理頁面增強

**之前**：只有簡單的說明文字

**現在**：
- ✅ 完整的格式說明和範例
- ✅ 視覺化表格範例
- ✅ 重要提示和注意事項
- ✅ 顯示目前載入的事業單位列表
- ✅ 一鍵重新載入功能

#### 3. 自動載入功能

**新增**：
- ✅ 載入排班資料時自動載入事業單位
- ✅ 背景自動更新，不干擾使用者

---

## 🔧 技術改進

### JavaScript 函數

#### 新增函數

1. **`loadUnits(showAlert = true)`**
   - 從 Google Sheets 讀取事業單位
   - 更新事業單位下拉選單
   - 可選擇是否顯示提示訊息

2. **`refreshUnits()`**
   - 手動重新載入事業單位
   - 包含登入狀態檢查

3. **`displayUnitsTable(units)`**
   - 在事業單位頁籤顯示列表
   - 視覺化表格呈現

### HTML 更新

1. **排班表單**
   - 新增「🔄」重新載入按鈕
   - 新增提示文字

2. **事業單位頁籤**
   - 完整的格式說明
   - 視覺化範例表格
   - 重要提示區塊
   - 事業單位列表顯示區

---

## 📊 Google Sheets 結構

### 新增工作表要求

#### 工作表名稱
```
事業單位
```

#### 標題列（第 1 列）
```
| A: 事業單位名稱 | B: 地址 | C: 聯絡電話 | D: 備註 |
```

#### 資料範圍
```
事業單位!A2:D
```

#### 範例資料
```
| 台北診所 | 台北市信義區 | 02-12345678 | 週一至週五營業 |
| 新竹診所 | 新竹市東區   | 03-87654321 | 週六上午營業   |
```

---

## 📄 新增文檔

### 1. `GOOGLE_SHEETS_SETUP_GUIDE.md`
- 完整的 Google Sheets 設定指南
- 包含排班資料和事業單位兩個工作表的詳細說明
- 圖文並茂的範例
- 常見問題解答

### 2. `UNITS_SETUP_QUICK.md`
- 2 分鐘快速設定指南
- 簡潔的步驟說明
- 重點提示

### 3. `CHANGELOG_UNITS.md`（本文件）
- 更新日誌
- 功能對比
- 技術細節

---

## 🔄 功能對比

| 功能 | v2.0.0（之前）| v2.1.0（現在）|
|------|-------------|-------------|
| 事業單位選擇 | ❌ 下拉選單為空 | ✅ 從 Google Sheets 載入 |
| 事業單位管理 | ⚠️ 只有簡單說明 | ✅ 完整的管理頁面 |
| 格式範例 | ❌ 無 | ✅ 視覺化表格範例 |
| 重新載入 | ❌ 無 | ✅ 一鍵重新載入 |
| 自動載入 | ❌ 無 | ✅ 載入排班時自動載入 |
| 列表顯示 | ❌ 無 | ✅ 顯示已載入的事業單位 |
| 文檔 | ⚠️ 基本說明 | ✅ 完整設定指南 |

---

## 🚀 使用流程

### 設定流程（首次）

```
1. 在 Google Sheets 建立「事業單位」工作表
   ↓
2. 設定標題列：事業單位名稱 | 地址 | 聯絡電話 | 備註
   ↓
3. 從第 2 列開始輸入事業單位資料
   ↓
4. 回到排班系統
   ↓
5. 點擊「🏢 事業單位」→「🔄 重新載入事業單位」
   ↓
6. 完成！✅
```

### 日常使用流程

```
1. 新增排班
   ↓
2. 點擊「➕ 新增排班」
   ↓
3. 選擇「事業單位」（下拉選單已有選項）
   ↓
4. 填寫其他資料
   ↓
5. 儲存 ✅
```

### 新增事業單位流程

```
1. 在 Google Sheets 的「事業單位」工作表新增一列
   ↓
2. 回到排班系統
   ↓
3. 點擊「事業單位」欄位旁的「🔄」按鈕
   ↓
4. 新事業單位出現在下拉選單 ✅
```

---

## ⚠️ 重要提醒

### 必須滿足的條件

1. ✅ Google Sheets 中必須有「事業單位」工作表
2. ✅ 工作表名稱必須完全相同（區分大小寫）
3. ✅ 第 1 列必須是標題列
4. ✅ 資料從第 2 列開始
5. ✅ A 欄（事業單位名稱）不能為空

### 如果事業單位下拉選單沒有選項

**檢查步驟：**
1. 確認 Google Sheets 中有「事業單位」工作表
2. 確認工作表中有資料（第 2 列開始）
3. 確認 A 欄有事業單位名稱
4. 點擊「🔄」重新載入
5. 查看瀏覽器 Console 是否有錯誤訊息

**常見錯誤：**
- ❌ 工作表名稱拼寫錯誤（例如「事業单位」、「單位」）
- ❌ 標題列在第 2 列而不是第 1 列
- ❌ A 欄為空白
- ❌ 未授權 Google Sheets API 存取權限

---

## 📈 未來計畫

### 可能的增強功能

- ⏳ 在系統中直接新增/編輯事業單位
- ⏳ 事業單位詳細資料顯示（地址、電話）
- ⏳ 事業單位統計報表
- ⏳ 事業單位篩選和搜尋
- ⏳ 事業單位顏色設定
- ⏳ 匯入/匯出事業單位資料

---

## 🐛 已知問題

目前沒有已知問題。如發現問題請回報。

---

## 📞 需要幫助？

### 相關文檔

- [Google Sheets 完整設定指南](GOOGLE_SHEETS_SETUP_GUIDE.md)
- [事業單位快速設定](UNITS_SETUP_QUICK.md)
- [快速開始指南](QUICK_START_WEB_SHEETS.md)
- [問題排除](TROUBLESHOOTING_LOGIN.md)
- [匯出與統計](EXPORT_AND_STATS_GUIDE.md)
- [OAuth 錯誤修復](FIX_OAUTH_ERROR.md)

### 檢查清單

如果遇到問題，請檢查：

- [ ] 已登入 Google 帳號
- [ ] 已完成 Google API 設定（Client ID、Sheet ID）
- [ ] Google Sheets 中有「事業單位」工作表
- [ ] 工作表名稱完全相同
- [ ] 第 1 列是標題列
- [ ] 第 2 列開始有資料
- [ ] A 欄不為空白
- [ ] 已授權 Google Sheets API

---

**版本**：2.1.0  
**發布日期**：2025-11-03  
**主要更新**：事業單位從 Google Sheets 載入

---

**立即試用新功能！** 🚀



