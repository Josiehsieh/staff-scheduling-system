<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‡æ—¥ API æ¸¬è©¦å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .test-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        select, input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            margin-left: 10px;
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
        }

        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .result.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .result.warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            padding: 15px;
            background: white;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .holiday-list {
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .holiday-item {
            padding: 10px;
            margin-bottom: 8px;
            background: white;
            border-radius: 6px;
            border-left: 3px solid #f44336;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .holiday-date {
            font-weight: 600;
            color: #f44336;
        }

        .holiday-name {
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—“ï¸ å‡æ—¥ API æ¸¬è©¦å·¥å…·</h1>
        <p class="subtitle">è¨ºæ–·å‡æ—¥è¼‰å…¥å•é¡Œ - v4.0.1</p>

        <!-- æ¸¬è©¦è¨­å®š -->
        <div class="test-section">
            <h2>ğŸ¯ æ¸¬è©¦è¨­å®š</h2>
            
            <div class="input-group">
                <label>é¸æ“‡åœ‹å®¶/åœ°å€</label>
                <select id="countrySelect">
                    <option value="TW">ğŸ‡¹ğŸ‡¼ å°ç£ (Taiwan)</option>
                    <option value="US">ğŸ‡ºğŸ‡¸ ç¾åœ‹ (United States)</option>
                    <option value="GB">ğŸ‡¬ğŸ‡§ è‹±åœ‹ (United Kingdom)</option>
                    <option value="JP">ğŸ‡¯ğŸ‡µ æ—¥æœ¬ (Japan)</option>
                    <option value="CN">ğŸ‡¨ğŸ‡³ ä¸­åœ‹ (China)</option>
                    <option value="HK">ğŸ‡­ğŸ‡° é¦™æ¸¯ (Hong Kong)</option>
                    <option value="DE">ğŸ‡©ğŸ‡ª å¾·åœ‹ (Germany)</option>
                    <option value="FR">ğŸ‡«ğŸ‡· æ³•åœ‹ (France)</option>
                    <option value="AU">ğŸ‡¦ğŸ‡º æ¾³æ´² (Australia)</option>
                    <option value="CA">ğŸ‡¨ğŸ‡¦ åŠ æ‹¿å¤§ (Canada)</option>
                </select>
            </div>

            <div class="input-group">
                <label>å¹´ä»½</label>
                <input type="number" id="yearInput" value="2025" min="2020" max="2030">
            </div>

            <button class="btn btn-primary" onclick="runTest()">â–¶ï¸ é–‹å§‹æ¸¬è©¦</button>
            <button class="btn btn-secondary" onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤çµæœ</button>
        </div>

        <!-- æ¸¬è©¦çµæœ -->
        <div class="test-section">
            <h2>ğŸ“Š æ¸¬è©¦çµæœ</h2>
            <div id="testResults"></div>
        </div>

        <!-- å‡æ—¥åˆ—è¡¨ -->
        <div class="test-section" id="holidaySection" style="display: none;">
            <h2>ğŸ‰ å‡æ—¥åˆ—è¡¨</h2>
            <div class="stats" id="statsContainer"></div>
            <div class="holiday-list" id="holidayList"></div>
        </div>
    </div>

    <script>
        let testStartTime;

        async function runTest() {
            const country = document.getElementById('countrySelect').value;
            const year = document.getElementById('yearInput').value;
            const resultsDiv = document.getElementById('testResults');
            const holidaySection = document.getElementById('holidaySection');

            testStartTime = Date.now();
            resultsDiv.innerHTML = '<div class="loading"></div>æ­£åœ¨æ¸¬è©¦...';
            holidaySection.style.display = 'none';

            let log = '';

            try {
                // æ­¥é©Ÿ1ï¼šæ§‹å»º URL
                const url = `https://date.nager.at/api/v3/PublicHolidays/${year}/${country}`;
                log += `ğŸ”— æ¸¬è©¦ URL:\n${url}\n\n`;

                // æ­¥é©Ÿ2ï¼šç™¼é€è«‹æ±‚
                log += `ğŸ“¡ ç™¼é€ HTTP GET è«‹æ±‚...\n`;
                const fetchStartTime = Date.now();
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                const fetchTime = Date.now() - fetchStartTime;
                log += `â±ï¸ è«‹æ±‚è€—æ™‚ï¼š${fetchTime}ms\n\n`;

                // æ­¥é©Ÿ3ï¼šæª¢æŸ¥ç‹€æ…‹ç¢¼
                log += `ğŸ“‹ HTTP å›æ‡‰ç‹€æ…‹ï¼š${response.status} ${response.statusText}\n`;
                
                // ç‰¹æ®Šè™•ç† HTTP 204 No Content
                if (response.status === 204) {
                    log += `â„¹ï¸ HTTP 204 No Content - è©²åœ‹å®¶/å¹´ä»½ç„¡å‡æ—¥è³‡æ–™\n\n`;
                    log += `â±ï¸ ç¸½è€—æ™‚ï¼š${Date.now() - testStartTime}ms\n\n`;
                    log += `âœ… API é€£ç·šæ­£å¸¸ï¼Œä½†è©²åœ‹å®¶/å¹´ä»½ç„¡å‡æ—¥è³‡æ–™ã€‚\n\n`;
                    log += `ğŸ’¡ å»ºè­°ï¼š\n`;
                    log += `1. å˜—è©¦å…¶ä»–åœ‹å®¶ï¼ˆå¦‚ç¾åœ‹ã€è‹±åœ‹ã€æ—¥æœ¬ï¼‰\n`;
                    log += `2. æª¢æŸ¥å¹´ä»½æ˜¯å¦æ­£ç¢º\n`;
                    log += `3. è©²åœ‹å®¶å¯èƒ½ä¸åœ¨ API æ”¯æ´åˆ—è¡¨ä¸­\n`;
                    
                    resultsDiv.innerHTML = `<div class="result info">${log}</div>`;
                    
                    // é¡¯ç¤ºç©ºçš„å‡æ—¥åˆ—è¡¨
                    displayHolidays([], country, year, Date.now() - testStartTime);
                    return;
                }
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status} - ${response.statusText}`);
                }
                log += `âœ… HTTP ç‹€æ…‹ç¢¼æ­£å¸¸\n\n`;

                // æ­¥é©Ÿ4ï¼šæª¢æŸ¥ Content-Type
                const contentType = response.headers.get('content-type');
                log += `ğŸ“„ Content-Typeï¼š${contentType}\n`;
                
                if (!contentType || !contentType.includes('application/json')) {
                    throw new Error(`Content-Type ä¸æ˜¯ JSONï¼š${contentType}`);
                }
                log += `âœ… Content-Type æ­£ç¢º\n\n`;

                // æ­¥é©Ÿ5ï¼šè®€å–éŸ¿æ‡‰æ–‡æœ¬
                log += `ğŸ“¥ è®€å–éŸ¿æ‡‰å…§å®¹...\n`;
                const text = await response.text();
                log += `ğŸ“Š éŸ¿æ‡‰é•·åº¦ï¼š${text.length} å­—å…ƒ\n`;

                if (!text || text.trim().length === 0) {
                    throw new Error('éŸ¿æ‡‰å…§å®¹ç‚ºç©º');
                }
                log += `âœ… éŸ¿æ‡‰å…§å®¹ä¸ç‚ºç©º\n\n`;

                // æ­¥é©Ÿ6ï¼šè§£æ JSON
                log += `ğŸ”§ è§£æ JSON...\n`;
                let data;
                try {
                    data = JSON.parse(text);
                } catch (e) {
                    log += `âŒ JSON è§£æå¤±æ•—\n`;
                    log += `éŒ¯èª¤ï¼š${e.message}\n`;
                    log += `å…§å®¹å‰100å­—ï¼š${text.substring(0, 100)}\n`;
                    throw e;
                }
                log += `âœ… JSON è§£ææˆåŠŸ\n\n`;

                // æ­¥é©Ÿ7ï¼šé©—è­‰è³‡æ–™æ ¼å¼
                log += `ğŸ“ é©—è­‰è³‡æ–™æ ¼å¼...\n`;
                if (!Array.isArray(data)) {
                    log += `âš ï¸ è­¦å‘Šï¼šè³‡æ–™ä¸æ˜¯é™£åˆ—æ ¼å¼\n`;
                    data = [];
                }
                log += `âœ… è³‡æ–™æ ¼å¼æ­£ç¢º\n\n`;

                // æ­¥é©Ÿ8ï¼šçµ±è¨ˆå‡æ—¥æ•¸é‡
                const holidayCount = data.length;
                log += `ğŸ‰ å‡æ—¥æ•¸é‡ï¼š${holidayCount} å€‹\n\n`;

                // ç¸½çµ
                const totalTime = Date.now() - testStartTime;
                log += `â±ï¸ ç¸½è€—æ™‚ï¼š${totalTime}ms\n\n`;
                log += `âœ…âœ…âœ… æ¸¬è©¦æˆåŠŸï¼æ‰€æœ‰æª¢æŸ¥éƒ½é€šéï¼\n\n`;
                log += `çµè«–ï¼šAPI æ­£å¸¸é‹ä½œï¼Œå¯ä»¥æˆåŠŸè¼‰å…¥å‡æ—¥è³‡æ–™ã€‚`;

                // é¡¯ç¤ºæˆåŠŸçµæœ
                resultsDiv.innerHTML = `<div class="result success">${log}</div>`;

                // é¡¯ç¤ºå‡æ—¥åˆ—è¡¨
                displayHolidays(data, country, year, totalTime);

            } catch (error) {
                log += `\nâŒâŒâŒ æ¸¬è©¦å¤±æ•—ï¼\n\n`;
                log += `éŒ¯èª¤é¡å‹ï¼š${error.name}\n`;
                log += `éŒ¯èª¤è¨Šæ¯ï¼š${error.message}\n\n`;

                // è¨ºæ–·å»ºè­°
                log += `ğŸ“‹ è¨ºæ–·å»ºè­°ï¼š\n\n`;

                if (error.message.includes('NetworkError') || error.message.includes('Failed to fetch')) {
                    log += `1. ç¶²è·¯é€£ç·šå•é¡Œ\n`;
                    log += `   â†’ æª¢æŸ¥ç¶²è·¯é€£ç·š\n`;
                    log += `   â†’ æª¢æŸ¥é˜²ç«ç‰†è¨­å®š\n`;
                    log += `   â†’ å˜—è©¦ä½¿ç”¨ VPN\n\n`;
                } else if (error.message.includes('404')) {
                    log += `1. API ç«¯é»ä¸å­˜åœ¨æˆ–åœ‹å®¶ä»£ç¢¼éŒ¯èª¤\n`;
                    log += `   â†’ å˜—è©¦å…¶ä»–åœ‹å®¶ï¼ˆå¦‚ US, GBï¼‰\n`;
                    log += `   â†’ æª¢æŸ¥å¹´ä»½æ˜¯å¦æ­£ç¢º\n\n`;
                } else if (error.message.includes('500')) {
                    log += `1. API ä¼ºæœå™¨éŒ¯èª¤\n`;
                    log += `   â†’ API å¯èƒ½æ­£åœ¨ç¶­è­·\n`;
                    log += `   â†’ ç¨å¾Œå†è©¦\n\n`;
                } else if (error.message.includes('JSON')) {
                    log += `1. JSON è§£æéŒ¯èª¤\n`;
                    log += `   â†’ API è¿”å›æ ¼å¼éŒ¯èª¤\n`;
                    log += `   â†’ å¯èƒ½æ­£åœ¨ç¶­è­·\n\n`;
                } else if (error.message.includes('CORS')) {
                    log += `1. CORS è·¨åŸŸå•é¡Œ\n`;
                    log += `   â†’ ä½¿ç”¨ http://localhost è€Œé file://\n`;
                    log += `   â†’ å•Ÿå‹•æœ¬åœ°ä¼ºæœå™¨\n\n`;
                }

                log += `2. é€šç”¨è§£æ±ºæ–¹æ³•ï¼š\n`;
                log += `   â†’ é‡æ–°æ•´ç†é é¢\n`;
                log += `   â†’ æ¸…é™¤ç€è¦½å™¨å¿«å–\n`;
                log += `   â†’ ä½¿ç”¨ç„¡ç—•æ¨¡å¼\n`;
                log += `   â†’ å˜—è©¦ä¸åŒç€è¦½å™¨\n`;

                resultsDiv.innerHTML = `<div class="result error">${log}</div>`;
            }
        }

        function displayHolidays(data, country, year, loadTime) {
            const holidaySection = document.getElementById('holidaySection');
            const statsContainer = document.getElementById('statsContainer');
            const holidayList = document.getElementById('holidayList');

            holidaySection.style.display = 'block';

            // çµ±è¨ˆè³‡è¨Š
            const globalHolidays = data.filter(h => h.global !== false).length;
            const localHolidays = data.length - globalHolidays;

            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${data.length}</div>
                    <div class="stat-label">ç¸½å‡æ—¥æ•¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${globalHolidays}</div>
                    <div class="stat-label">å…¨åœ‹æ€§å‡æ—¥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${localHolidays}</div>
                    <div class="stat-label">åœ°æ–¹æ€§å‡æ—¥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${loadTime}ms</div>
                    <div class="stat-label">è¼‰å…¥æ™‚é–“</div>
                </div>
            `;

            // å‡æ—¥åˆ—è¡¨
            let html = '';
            data.forEach(holiday => {
                html += `
                    <div class="holiday-item">
                        <span class="holiday-date">${holiday.date}</span>
                        <span class="holiday-name">${holiday.localName || holiday.name}</span>
                    </div>
                `;
            });

            holidayList.innerHTML = html || '<p style="text-align: center; color: #999;">ç„¡å‡æ—¥è³‡æ–™</p>';
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = '<div class="result info">ç­‰å¾…æ¸¬è©¦...</div>';
            document.getElementById('holidaySection').style.display = 'none';
        }

        // é é¢è¼‰å…¥æ™‚é¡¯ç¤ºèªªæ˜
        window.onload = function() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = `
                <div class="result info">
ğŸ‘‹ æ­¡è¿ä½¿ç”¨å‡æ—¥ API æ¸¬è©¦å·¥å…·ï¼

ğŸ“ ä½¿ç”¨æ–¹æ³•ï¼š
1. é¸æ“‡åœ‹å®¶/åœ°å€
2. è¼¸å…¥å¹´ä»½
3. é»æ“Šã€Œé–‹å§‹æ¸¬è©¦ã€
4. æŸ¥çœ‹è©³ç´°æ¸¬è©¦çµæœ

ğŸ¯ æ¸¬è©¦é …ç›®ï¼š
âœ“ HTTP é€£ç·šæ¸¬è©¦
âœ“ ç‹€æ…‹ç¢¼æª¢æŸ¥
âœ“ Content-Type é©—è­‰
âœ“ éŸ¿æ‡‰å…§å®¹æª¢æŸ¥
âœ“ JSON è§£ææ¸¬è©¦
âœ“ è³‡æ–™æ ¼å¼é©—è­‰

ğŸ’¡ æç¤ºï¼š
å¦‚æœæ¸¬è©¦å¤±æ•—ï¼Œè«‹æŸ¥çœ‹è©³ç´°éŒ¯èª¤è¨Šæ¯å’Œè¨ºæ–·å»ºè­°ã€‚
                </div>
            `;
        };
    </script>
</body>
</html>

