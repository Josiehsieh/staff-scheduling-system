# 📊 匯出與統計報表功能說明

## 🎉 新增功能概覽

`shift_management_system_sheets_full.html` 現在包含完整的**匯出**和**統計報表**功能！

---

## 📥 匯出功能

### 位置
在「✏️ 排班管理」頁籤中

### 功能按鈕
- **📥 匯出 Excel**：將所有排班資料匯出為 Excel 檔案

### 匯出內容
- 所有排班資料（日期、時間、單位、人員等）
- 自動設定欄寬，方便閱讀
- 檔案名稱：`排班資料_YYYY-MM-DD.xlsx`

### 使用方式

```
1. 點擊「✏️ 排班管理」頁籤
   ↓
2. 確認已載入排班資料
   ↓
3. 點擊「📥 匯出 Excel」按鈕
   ↓
4. Excel 檔案自動下載
```

### Excel 檔案格式

| 日期 | 開始時間 | 結束時間 | 事業單位 | 人員名單 | 地點 | 顏色 | 備註 |
|------|---------|---------|---------|---------|------|------|------|
| 2025-11-05 | 09:00 | 17:00 | 台北診所 | 王醫師, 李護理師 | 台北市 | #FF5733 | 日班 |

---

## 📊 統計報表功能

### 位置
新增「📊 統計報表」頁籤

### 4 種統計維度

#### 1️⃣ 總覽統計卡片
- **總排班數**：所選期間內的排班總次數
- **事業單位數**：參與排班的單位數量
- **參與人員數**：參與排班的人員總數（去重）
- **總工作時數**：所有排班的工作時數加總

#### 2️⃣ 按事業單位統計
顯示每個單位的：
- 排班次數
- 工作時數
- 參與人數

#### 3️⃣ 按人員統計
顯示每位人員的：
- 排班次數
- 工作時數
- 主要服務單位

#### 4️⃣ 按月份統計
顯示每個月份的：
- 排班次數
- 工作時數
- 平均每日排班次數

---

## 🚀 如何使用統計報表

### 步驟 1：進入統計報表頁籤

```
點擊導航欄的「📊 統計報表」
```

### 步驟 2：設定日期範圍

1. **開始日期**：選擇統計起始日期
2. **結束日期**：選擇統計結束日期

**建議範圍**：
- 月報表：選擇當月 1 日至月底
- 季報表：選擇季初至季末
- 年報表：選擇年初至年底

### 步驟 3：產生報表

點擊「🔍 產生報表」按鈕

### 步驟 4：查看統計結果

系統會自動計算並顯示：
- ✅ 4 張統計卡片（頂部彩色卡片）
- ✅ 按事業單位統計表格
- ✅ 按人員統計表格
- ✅ 按月份統計表格

### 步驟 5：匯出統計報表（可選）

點擊「📥 匯出報表」按鈕，產生包含 4 個工作表的 Excel 檔案：

1. **總覽**：統計摘要
2. **按事業單位**：單位明細
3. **按人員**：人員明細
4. **按月份**：月份明細

---

## 💡 使用範例

### 範例 1：產生 11 月份月報表

```
1. 開始日期：2025-11-01
2. 結束日期：2025-11-30
3. 點擊「🔍 產生報表」
4. 查看結果：
   - 11 月共排班 45 次
   - 涉及 3 個事業單位
   - 15 位人員參與
   - 總工作時數 360 小時
```

### 範例 2：比較不同單位的排班量

```
1. 產生報表後
2. 查看「按事業單位統計」表格
3. 排序依據排班次數（由高到低）
4. 識別高負荷單位
```

### 範例 3：分析人員工作量

```
1. 產生報表後
2. 查看「按人員統計」表格
3. 找出工作時數最高的人員
4. 考慮工作分配調整
```

### 範例 4：追蹤月度趨勢

```
1. 開始日期：2025-01-01
2. 結束日期：2025-11-30
3. 查看「按月份統計」表格
4. 分析每月排班量變化
```

---

## 📈 統計指標說明

### 工作時數計算

```
工作時數 = 結束時間 - 開始時間

範例：
開始時間：09:00
結束時間：17:00
工作時數：8.0 小時
```

### 平均每日排班計算

```
平均每日排班 = 排班次數 ÷ 有排班的天數

範例：
11 月有 22 天有排班
總共 45 次排班
平均每日排班 = 45 ÷ 22 = 2.0 次/日
```

### 主要單位判定

```
主要單位 = 該人員排班次數最多的單位

範例：
王醫師在台北診所排班 10 次
王醫師在新竹診所排班 3 次
主要單位 = 台北診所
```

---

## 🎨 統計卡片顏色說明

系統使用漸層色卡片讓統計數據更易讀：

- **紫色漸層** 🟣：總排班數
- **粉紅漸層** 🩷：事業單位數
- **藍色漸層** 🔵：參與人員數
- **綠色漸層** 🟢：總工作時數

---

## 📊 匯出 Excel 格式

### 統計報表 Excel 檔案結構

#### 工作表 1：總覽
```
| 統計項目      | 數值                     |
|--------------|-------------------------|
| 報表日期範圍  | 2025-11-01 至 2025-11-30|
| 總排班數      | 45                      |
| 事業單位數    | 3                       |
| 參與人員數    | 15                      |
| 總工作時數    | 360.0 小時              |
```

#### 工作表 2：按事業單位
```
| 事業單位  | 排班次數 | 工作時數 | 參與人數 |
|----------|---------|---------|---------|
| 台北診所  | 20 次   | 160.0 小時| 8 人    |
| 新竹診所  | 15 次   | 120.0 小時| 6 人    |
| 台中診所  | 10 次   | 80.0 小時 | 5 人    |
```

#### 工作表 3：按人員
```
| 人員姓名 | 排班次數 | 工作時數 | 主要單位 |
|---------|---------|---------|---------|
| 王醫師   | 10 次   | 80.0 小時| 台北診所 |
| 李護理師 | 8 次    | 64.0 小時| 台北診所 |
```

#### 工作表 4：按月份
```
| 月份    | 排班次數 | 工作時數   | 平均每日排班 |
|---------|---------|-----------|-------------|
| 2025-11 | 45 次   | 360.0 小時 | 2.0 次/日   |
```

---

## ⚠️ 注意事項

### 1. 資料篩選

- 統計報表**只計算**所選日期範圍內的排班
- 確保選擇正確的開始和結束日期

### 2. 資料完整性

- 確保 Google Sheets 中的資料格式正確
- 必填欄位：日期、開始時間、結束時間、事業單位、人員名單

### 3. 時間格式

- 開始時間和結束時間必須是 `HH:MM` 格式
- 例如：`09:00`、`17:30`

### 4. 人員名單分隔

- 多位人員請用逗號分隔
- 例如：`王醫師, 李護理師, 張技師`

### 5. 匯出前確認

- 確保已產生報表後再匯出
- 檢查日期範圍是否正確

---

## 🔧 常見問題

### Q1：為什麼統計卡片顯示 0？

**答**：請先選擇日期範圍並點擊「🔍 產生報表」

### Q2：為什麼統計表格是空的？

**答**：所選日期範圍內可能沒有排班資料，請檢查：
- 日期範圍是否正確
- Google Sheets 中是否有該期間的資料
- 是否已載入排班資料

### Q3：如何匯出特定月份的報表？

**答**：
```
1. 設定開始日期：該月 1 日
2. 設定結束日期：該月最後一日
3. 點擊「🔍 產生報表」
4. 點擊「📥 匯出報表」
```

### Q4：工作時數怎麼計算的？

**答**：工作時數 = 結束時間 - 開始時間（單位：小時）

### Q5：可以匯出圖表嗎？

**答**：目前匯出功能僅支援表格資料，您可以在 Excel 中使用這些資料自行建立圖表

### Q6：Excel 檔案下載在哪裡？

**答**：檔案會下載到您的瀏覽器預設下載資料夾（通常是「下載」或「Downloads」）

---

## 📝 使用技巧

### 技巧 1：快速設定本月日期

```javascript
// 在瀏覽器控制台執行（F12）
const now = new Date();
const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);

document.getElementById('statsStartDate').value = 
    firstDay.toISOString().split('T')[0];
document.getElementById('statsEndDate').value = 
    lastDay.toISOString().split('T')[0];
```

### 技巧 2：對比不同時期

1. 產生第一期報表並匯出
2. 產生第二期報表並匯出
3. 在 Excel 中開啟兩個檔案進行對比

### 技巧 3：製作視覺化報告

1. 匯出統計報表 Excel
2. 在 Excel 中插入圖表
3. 建議圖表類型：
   - 按事業單位：長條圖
   - 按人員：橫條圖
   - 按月份：折線圖

### 技巧 4：定期備份

建議每月月初匯出上月報表，作為歷史記錄保存

---

## 🎯 使用流程建議

### 每日
- 查看當日排班（排班檢視頁籤）

### 每週
- 匯出本週排班資料（排班管理 → 匯出 Excel）

### 每月
- 產生月報表（統計報表頁籤）
- 匯出月報表 Excel
- 分析單位和人員負荷
- 規劃下月排班

### 每季
- 產生季報表
- 比對三個月趨勢
- 調整排班策略

### 每年
- 產生年度報表
- 製作年度總結
- 規劃次年人力配置

---

## 📞 功能清單

### ✅ 已實現功能

- ✅ 匯出所有排班資料為 Excel
- ✅ 設定日期範圍進行統計
- ✅ 總覽統計卡片（4 項指標）
- ✅ 按事業單位統計表格
- ✅ 按人員統計表格
- ✅ 按月份統計表格
- ✅ 匯出統計報表為 Excel（4 個工作表）
- ✅ 工作時數自動計算
- ✅ 人員去重統計
- ✅ 主要單位判定

### 🚀 未來可能增強

- ⏳ 圖表視覺化（長條圖、圓餅圖）
- ⏳ 匯出 PDF 格式報表
- ⏳ 排班衝突檢測
- ⏳ 人員負荷預警
- ⏳ 自動排班建議
- ⏳ 歷史趨勢分析

---

## 🎉 總結

現在您擁有完整的排班管理系統，包括：

1. **排班檢視** 📅：視覺化月曆
2. **排班管理** ✏️：新增、編輯、刪除
3. **資料匯出** 📥：Excel 格式
4. **統計報表** 📊：多維度分析
5. **報表匯出** 📈：詳細 Excel 報表

**立即開始使用這些強大的功能吧！** 🚀

---

## 📚 相關文檔

- [快速開始指南](QUICK_START_WEB_SHEETS.md)
- [Google API 設定](WEB_GOOGLE_SHEETS_SETUP.md)
- [問題排除](TROUBLESHOOTING_LOGIN.md)
- [如何運行網頁](HOW_TO_RUN_WEB.md)

有任何問題或建議，歡迎隨時反饋！ 😊



