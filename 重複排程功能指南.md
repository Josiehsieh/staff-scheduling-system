# 🔄 重複排程功能指南

## 功能概述

新增的重複排程功能允許您一次創建多個排班，支援以下重複模式：
- **每天重複**：連續每天排班
- **每週重複**：每週固定星期排班
- **每兩週重複**：每兩週固定星期排班
- **每月重複**：每月固定日期排班

## 使用步驟

### 1. 開啟新增排班表單

在「排班管理」頁籤中，點擊「➕ 新增排班」按鈕，或直接點擊月曆上的日期。

### 2. 填寫基本排班資訊

- **日期**：選擇第一個排班的日期（作為重複排程的基準日期）
- **時間**：設定開始和結束時間
- **事業單位**：選擇事業單位
- **人員名單**：勾選參與排班的人員
- **地點**：系統會自動根據事業單位設定
- **顏色**：選擇排班顯示顏色
- **備註**：可選填

### 3. 啟用重複排程

勾選「🔄 啟用重複排程」選項，會展開重複設定區域。

### 4. 設定重複規則

#### A. 選擇重複頻率

- **每天**：每天都會建立排班
- **每週**：每週固定星期建立排班
- **每兩週**：每兩週固定星期建立排班
- **每月**：每月固定日期建立排班

#### B. 選擇重複方式

**選項 1：重複次數**
- 設定要建立幾次排班
- 範圍：1-52次
- 例如：設定「4」表示建立 4 個排班

**選項 2：重複至日期**
- 設定重複到哪一天為止
- 系統會自動計算在此日期之前可以建立的所有排班

#### C. 選擇星期（僅每週/每兩週模式）

- 當選擇「每週」或「每兩週」時，可以勾選要排班的星期
- 可以多選，例如同時選擇星期一、三、五
- 預設會勾選基準日期的星期

### 5. 查看預覽

在設定區域下方的「📅 預覽」區塊會即時顯示：
- 將建立的排班總數
- 前 10 個排班的日期和星期
- 如果超過 10 個，會顯示剩餘數量

### 6. 儲存排班

點擊「💾 儲存」按鈕後：
1. 系統會顯示確認對話框，告知將建立的排班數量
2. 確認後，系統會顯示進度視窗
3. 完成後會顯示成功和失敗的統計
4. 自動返回排班列表

## 使用範例

### 範例 1：每週固定排班

**情境**：每週一和週五都需要到某診所排班，持續 4 週

**設定**：
- 日期：選擇第一個週一的日期（例如：2025-01-06）
- 重複頻率：每週
- 重複方式：重複次數 = 8（4週 × 2天）
- 星期選擇：勾選「一」和「五」

**結果**：系統會建立 8 個排班，分別在接下來 4 週的每週一和週五

### 範例 2：每兩週輪值

**情境**：每兩週的週三需要排班，持續 3 個月

**設定**：
- 日期：選擇第一個週三的日期
- 重複頻率：每兩週
- 重複方式：重複至日期 = 三個月後的日期
- 星期選擇：勾選「三」

**結果**：系統會自動計算並建立所有符合條件的排班

### 範例 3：每月固定日期

**情境**：每月 15 日需要進行例行檢查，持續 6 個月

**設定**：
- 日期：2025-01-15
- 重複頻率：每月
- 重複方式：重複次數 = 6

**結果**：系統會建立 6 個排班：1/15、2/15、3/15、4/15、5/15、6/15

### 範例 4：連續多日排班

**情境**：連續 5 天需要排班（例如：特殊專案）

**設定**：
- 日期：專案開始日期
- 重複頻率：每天
- 重複方式：重複次數 = 5

**結果**：系統會建立 5 個連續日期的排班

## 注意事項

### ✅ 功能特點

1. **智能預覽**：設定任何參數後，預覽會立即更新
2. **防呆設計**：系統會檢查設定是否合理，避免錯誤
3. **進度顯示**：建立過程中會顯示即時進度
4. **批量操作**：一次可建立最多 52 個排班
5. **錯誤處理**：如果部分排班建立失敗，會列出失敗的日期

### ⚠️ 使用限制

1. **編輯模式不支援**：編輯現有排班時無法使用重複功能
2. **最大次數**：重複次數最多 52 次（一年）
3. **時間限制**：所有排班使用相同的開始和結束時間
4. **人員不變**：所有排班使用相同的人員名單

### 💡 最佳實踐

1. **先測試小範圍**：第一次使用時，先設定少量次數（如 2-3 次）測試
2. **檢查預覽**：儲存前仔細查看預覽的日期是否正確
3. **避免重複**：儲存前確認這些日期沒有現有的排班
4. **使用星期選擇**：對於每週/每兩週排班，靈活使用星期選擇功能

## 常見問題

### Q1：可以修改重複排班的其中一個嗎？

**A**：可以。重複排程建立的排班是獨立的，您可以單獨編輯或刪除任何一個。

### Q2：如果設定錯誤怎麼辦？

**A**：在確認對話框中可以取消操作。如果已經建立，可以在排班列表中批量刪除。

### Q3：可以為不同星期設定不同時間嗎？

**A**：目前不支援。所有重複排班使用相同的時間和人員。如需不同設定，請分別建立。

### Q4：預覽顯示的數量和實際建立的數量不一致？

**A**：請檢查：
- 結束日期是否正確
- 星期選擇是否符合預期
- 是否有與現有排班衝突（系統仍會建立，但可能造成重複）

### Q5：建立過程可以中斷嗎？

**A**：不建議在建立過程中關閉視窗。如果必須中斷，已建立的排班會保留，未建立的會停止。

## 技術細節

### 日期生成邏輯

- **每天**：從基準日期開始，每天增加 1 天
- **每週**：尋找符合選定星期的日期
- **每兩週**：以基準日期為起點，每兩週尋找符合的星期
- **每月**：每月的相同日期（如果該月沒有該日期，會跳過）

### API 請求限制

為避免 Google Sheets API 限制，系統會：
- 每次建立排班後等待 100ms
- 顯示即時進度
- 記錄失敗的請求

## 更新日誌

**版本：v6.1.0**
- ✨ 新增重複排程功能
- 🎨 黃色區塊突出顯示重複設定
- 📊 即時預覽重複日期
- 🔄 支援四種重複頻率
- ⚡ 批量建立排班

---

**提示**：如有任何問題或建議，請記錄在系統的備註中或聯繫管理員。

