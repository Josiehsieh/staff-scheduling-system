# 🎯 重大功能更新需求 - v4.0.0

## 📋 您要求的功能清單

### 1. ✅ 月曆點擊日期新增排班
**需求**：點擊月曆上的日期直接開啟新增排班表單，自動填入日期

**實現難度**：⭐⭐ 中等  
**預計時間**：30分鐘

---

### 2. ✅ 開始時間自動計算結束時間（+2小時）
**需求**：輸入開始時間後，自動設定結束時間為開始時間+2小時

**實現難度**：⭐ 簡單  
**預計時間**：15分鐘

---

### 3. ✅ 事業單位顯示剩餘時數（即時更新）
**需求**：下拉選單顯示「台北診所 (醫:160h / 護:180h)」格式，動態計算剩餘時數

**實現難度**：⭐⭐⭐⭐ 複雜  
**預計時間**：1-2小時

**技術挑戰**：
- 需要載入事業單位的月度時數配額
- 計算當月已排時數（依人員類型）
- 即時更新顯示
- 效能優化（快取）

---

### 4. ✅ 人員名單改為勾選方式
**需求**：不是文字輸入，而是從單位人員列表動態生成勾選框

**實現難度**：⭐⭐⭐ 中高  
**預計時間**：1小時

**技術挑戰**：
- 載入單位人員列表
- 動態生成勾選框
- 醫生/護理師/其他分組顯示
- 收集勾選結果並儲存

---

### 5. ✅ 地點選擇（分散型單位）
**需求**：如果是分散型單位，提供分點下拉選單

**實現難度**：⭐⭐ 中等  
**預計時間**：30分鐘

---

### 6. ✅ 日曆自動匯入假日並顯示紅色
**需求**：整合假日API，在月曆上顯示假日（紅色背景）

**實現難度**：⭐⭐⭐ 中高  
**預計時間**：1-1.5小時

**技術挑戰**：
- 選擇並整合假日API
- 實現快取機制
- 月曆UI更新
- 效能優化

---

### 7. ✅ 設定處選擇國家假日
**需求**：在設定頁籤新增國家選擇下拉選單

**實現難度**：⭐ 簡單  
**預計時間**：20分鐘

---

## ⏱️ 總計預估

**總開發時間**：約 **4-6 小時**

**難度等級**：⭐⭐⭐⭐ 高複雜度

---

## 🔧 技術複雜度分析

### 最複雜的功能

#### 3. 事業單位剩餘時數顯示

**為什麼複雜？**

1. **資料來源多**
   - 需要從「事業單位詳細」工作表讀取月度配額
   - 需要從「排班資料」計算已用時數
   - 需要解析人員名單判斷類型

2. **計算邏輯複雜**
   ```
   剩餘時數 = 月度配額 - 當月已排時數
   
   需要：
   - 識別當前月份
   - 過濾該單位排班
   - 計算每筆排班時數
   - 區分醫生/護理師/其他
   - 即時更新
   ```

3. **效能考量**
   - 每次選擇單位都要計算
   - 需要快取避免重複計算
   - 大量排班資料時的效能

4. **UI 更新**
   - 下拉選單文字動態生成
   - 選擇單位後即時更新
   - 新增排班後更新所有顯示

---

## 💡 實現建議

### 方案 A：完整實現（推薦）

**優點**：
- ✅ 所有功能完整實現
- ✅ 最佳使用者體驗
- ✅ 智慧化管理

**缺點**：
- ⏰ 需要 4-6 小時開發時間
- 🔧 技術複雜度高
- 🐛 需要更多測試

**適合**：
- 長期使用
- 需要精確時數管理
- 多人使用環境

---

### 方案 B：分階段實現

#### 階段 1（立即）- 基礎增強
- ✅ 點擊日期新增排班
- ✅ 時間自動計算
- ✅ 假日顯示

**預計時間**：1.5-2 小時

#### 階段 2（稍後）- 進階功能
- ✅ 人員勾選
- ✅ 地點選擇
- ✅ 剩餘時數顯示

**預計時間**：2.5-3 小時

---

### 方案 C：簡化實現

**調整需求**：

1. **時數顯示**：不即時更新，只在載入時計算一次
2. **人員勾選**：保留文字輸入，提供「快速選擇」按鈕
3. **假日**：使用固定台灣假日，不支援多國

**預計時間**：2-3 小時

---

## 🎯 我的建議

### 推薦：方案 B（分階段實現）

**理由**：
1. ✅ 快速看到效果（階段1）
2. ✅ 降低風險（分批測試）
3. ✅ 靈活調整（根據使用回饋）
4. ✅ 不影響現有功能

### 階段 1 優先實現（立即開始）

```
1. 點擊日期新增排班
   - 最直觀的改進
   - 立即提升使用體驗
   
2. 時間自動+2小時
   - 簡單但實用
   - 減少錯誤

3. 假日顯示（紅色）
   - 視覺化改進
   - 避免排班衝突
```

### 階段 2 進階功能（之後）

```
4. 人員勾選
   - 需要測試最佳UI
   - 根據實際使用調整

5. 剩餘時數顯示
   - 需要更多測試
   - 確保計算正確

6. 地點選擇
   - 配合分散型單位
```

---

## ❓ 需要您的決定

請選擇實現方案：

### 選項 1：立即完整實現（方案 A）
**我現在開始實現所有功能**
- ⏰ 4-6小時
- ✅ 一次到位

### 選項 2：分階段實現（方案 B）推薦
**先實現階段1（基礎增強）**
- ⏰ 1.5-2小時
- ✅ 快速見效
- ✅ 降低風險

### 選項 3：簡化實現（方案 C）
**簡化部分功能需求**
- ⏰ 2-3小時
- ⚠️ 部分功能簡化

---

## 📊 功能對比表

| 功能 | 方案A | 方案B-階段1 | 方案B-階段2 | 方案C |
|------|-------|-------------|-------------|-------|
| 點擊日期 | ✅ | ✅ | ✅ | ✅ |
| 時間+2h | ✅ | ✅ | ✅ | ✅ |
| 假日顯示 | ✅ | ✅ | ✅ | ✅ 台灣 |
| 多國假日 | ✅ | ✅ | ✅ | ❌ |
| 人員勾選 | ✅ | ❌ | ✅ | ⚠️ 簡化 |
| 地點選擇 | ✅ | ❌ | ✅ | ✅ |
| 剩餘時數（即時）| ✅ | ❌ | ✅ | ⚠️ 非即時 |
| **預計時間** | 4-6h | 1.5-2h | +2.5-3h | 2-3h |

---

## 💬 建議回應

**如果選擇方案 B（分階段）**，請告訴我：
```
"好的，先實現階段1的基礎功能"
```

**如果選擇方案 A（完整實現）**，請告訴我：
```
"請完整實現所有功能"
```

**如果需要討論或調整**，請告訴我：
```
"我想調整功能需求..."
```

---

## 📝 備註

1. **現有功能不受影響**：所有新功能都是增強，不會破壞現有功能
2. **資料相容性**：Google Sheets 資料結構保持相容
3. **可逐步升級**：分階段實現時，各階段獨立運作
4. **完整文檔**：完成後提供完整使用說明

---

**等待您的決定，準備開始實現！** 🚀

**我的建議是：先實現階段 1（基礎增強），快速看到效果，然後根據使用情況決定是否繼續階段 2。**



