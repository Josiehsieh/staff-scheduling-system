# 網頁版 Google Sheets 設定指南

本指南說明如何設定 Google Cloud API，讓網頁版排班系統連接 Google Sheets。

---

## 🎯 目標

設定完成後，您的網頁版排班系統可以：
- ✅ 從 Google Sheets 讀取排班資料
- ✅ 寫入新的排班到 Google Sheets
- ✅ 在試算表中直接編輯資料
- ✅ 多人協作管理排班

**未來 Android App 也可以使用同一個 Google Sheets！**

---

## 📝 準備工作

需要：
- ✅ Google 帳號
- ✅ 瀏覽器（Chrome 推薦）
- ✅ 約 30 分鐘時間

---

## 🔧 步驟 1: 建立 Google Cloud 專案（5 分鐘）

### 1.1 前往 Google Cloud Console

1. 開啟 [Google Cloud Console](https://console.cloud.google.com/)
2. 使用您的 Google 帳號登入

### 1.2 建立新專案

1. 點擊頂部的 **「選擇專案」** 下拉選單
2. 點擊 **「新增專案」**
3. 填寫資訊：
   - **專案名稱**: `Medical Shift System`
   - **位置**: 保持預設
4. 點擊 **「建立」**
5. 等待專案建立完成（約 10 秒）

---

## 🔌 步驟 2: 啟用 Google Sheets API（3 分鐘）

### 2.1 進入 API 程式庫

1. 確認已選擇剛建立的專案（左上角顯示專案名稱）
2. 點擊左側選單 **「API 和服務」** → **「程式庫」**

### 2.2 啟用 Google Sheets API

1. 在搜尋框輸入：`Google Sheets API`
2. 點擊 **「Google Sheets API」**
3. 點擊 **「啟用」** 按鈕
4. 等待啟用完成

✅ **完成！API 已啟用**

---

## 🔐 步驟 3: 設定 OAuth 同意畫面（10 分鐘）

### 3.1 進入 OAuth 同意畫面

1. 左側選單：**「API 和服務」** → **「OAuth 同意畫面」**
2. 選擇 **「外部」**（External）
3. 點擊 **「建立」**

### 3.2 填寫應用程式資訊

#### 第 1 頁：OAuth 同意畫面

填寫以下必填欄位：

```
應用程式名稱: 醫療排班管理系統
使用者支援電子郵件: [您的 Email]
應用程式標誌: (選填，可跳過)
應用程式首頁: (選填，可跳過)
應用程式隱私權政策連結: (選填，可跳過)
應用程式服務條款連結: (選填，可跳過)
已授權網域: (暫時跳過)
開發人員聯絡資訊: [您的 Email]
```

點擊 **「儲存並繼續」**

#### 第 2 頁：範圍（Scopes）

1. 點擊 **「新增或移除範圍」**

2. **方法 A（推薦）**：在搜尋框輸入完整 URL
   ```
   https://www.googleapis.com/auth/spreadsheets
   ```
   勾選這個範圍，點擊 **「更新」**

3. **方法 B**：如果找不到，可以暫時跳過
   - 點擊 **「儲存並繼續」**
   - 應用程式會在執行時請求權限

4. 點擊 **「儲存並繼續」**

#### 第 3 頁：測試使用者

1. 點擊 **「新增使用者」**
2. 輸入您的 Google 帳號 Email
3. 點擊 **「新增」**
4. 點擊 **「儲存並繼續」**

⚠️ **重要**：在測試模式下，只有加入「測試使用者」的帳號才能使用！

#### 第 4 頁：摘要

檢查資訊無誤後，點擊 **「返回資訊主頁」**

✅ **OAuth 同意畫面設定完成！**

---

## 🔑 步驟 4: 建立 OAuth 2.0 用戶端 ID（5 分鐘）

### 4.1 建立憑證

1. 左側選單：**「API 和服務」** → **「憑證」**
2. 點擊頂部 **「建立憑證」**
3. 選擇 **「OAuth 用戶端 ID」**

### 4.2 設定用戶端 ID

1. **應用程式類型**: 選擇 **「網頁應用程式」**

2. **名稱**: `Medical Shift Web App`

3. **授權的 JavaScript 來源**:
   - 點擊 **「新增 URI」**
   - 輸入以下 URI（根據您的使用方式）:

   ```
   本機測試用（必填）:
   http://localhost
   http://localhost:8000
   
   如果要部署到網路（選填）:
   https://yourdomain.com
   ```

4. **授權的重新導向 URI**:
   - 點擊 **「新增 URI」**
   - 輸入:
   ```
   http://localhost
   http://localhost:8000
   ```

5. 點擊 **「建立」**

### 4.3 儲存用戶端 ID

會出現一個對話框顯示：
- **用戶端 ID** - 類似：`123456789-abc...apps.googleusercontent.com`
- **用戶端密鑰** - 類似：`GOCSPX-...`

⚠️ **重要**：
- ✅ **複製並儲存「用戶端 ID」**（等等會用到）
- ⚠️ 用戶端密鑰（對網頁應用不一定需要）

✅ **OAuth 用戶端 ID 建立完成！**

---

## 📊 步驟 5: 建立 Google Sheets 試算表（5 分鐘）

### 5.1 建立新試算表

1. 前往 [Google Sheets](https://sheets.google.com)
2. 點擊 **「空白」** 建立新試算表
3. 將試算表命名為：**「醫療排班資料」**

### 5.2 設定工作表

1. 將第一個工作表（Sheet1）重新命名為：**「排班資料」**

2. 在第 1 列（標題列）輸入以下欄位：

| A | B | C | D | E | F | G | H |
|---|---|---|---|---|---|---|---|
| 日期 | 開始時間 | 結束時間 | 事業單位 | 人員名單 | 地點 | 顏色 | 備註 |

### 5.3 輸入範例資料

在第 2 列輸入測試資料：

| A | B | C | D | E | F | G | H |
|---|---|---|---|---|---|---|---|
| 2025-11-05 | 09:00 | 17:00 | 台北診所 | 王醫師, 李護理師 | 台北市中山區 | #FF5733 | 日班 |
| 2025-11-06 | 13:00 | 21:00 | 新竹診所 | 陳醫師 | 新竹市東區 | #33C3FF | 小夜班 |

### 5.4 取得 Sheet ID

1. 看瀏覽器網址列
2. 複製 `/d/` 和 `/edit` 之間的字串

```
https://docs.google.com/spreadsheets/d/【這段就是 Sheet ID】/edit
                                      ↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑
```

範例：
```
https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/edit
```
Sheet ID = `1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms`

⚠️ **重要**：複製並儲存這個 Sheet ID

✅ **Google Sheets 準備完成！**

---

## 🎉 步驟 6: 更新網頁版程式碼

### 6.1 需要的資訊

請準備好以下資訊：
- ✅ **Google API 用戶端 ID**（步驟 4 取得）
- ✅ **Google Sheets ID**（步驟 5 取得）

### 6.2 更新 HTML 檔案

我會幫您建立新的 HTML 檔案：`shift_management_system_sheets.html`

這個檔案會包含：
- Google Sheets API 整合
- OAuth 2.0 登入功能
- 讀取/寫入 Google Sheets 的功能

---

## ✅ 設定檢查清單

完成以下項目後，就可以開始使用：

- [ ] Google Cloud 專案已建立
- [ ] Google Sheets API 已啟用
- [ ] OAuth 同意畫面已設定
- [ ] 測試使用者已新增（您的 Google 帳號）
- [ ] OAuth 用戶端 ID 已建立（類型：網頁應用程式）
- [ ] 已記錄用戶端 ID
- [ ] Google Sheets 試算表已建立
- [ ] 試算表欄位格式正確
- [ ] 已記錄 Sheet ID
- [ ] HTML 檔案已更新（下一步）

---

## 🔄 與 Android App 的關係

設定完成後：

### 現在（網頁版）
```
網頁版 → Google Sheets API → 您的試算表
使用：OAuth 2.0（網頁應用程式）
```

### 未來（Android App）
```
Android App → Google Sheets API → 同一個試算表
使用：OAuth 2.0（Android）
```

**優點**：
- ✅ 資料統一，不用同步
- ✅ 網頁版和 App 看到相同資料
- ✅ 可以在試算表中直接編輯

---

## ❓ 常見問題

### Q1: 用戶端 ID 和 Sheet ID 有什麼不同？

**A**:
- **用戶端 ID** - 用來識別您的應用程式（授權用）
- **Sheet ID** - 用來識別您的試算表（資料來源）

### Q2: 為什麼要加測試使用者？

**A**: 因為應用程式在「測試」狀態，只有測試使用者名單中的帳號才能登入。

### Q3: 可以讓其他人使用嗎？

**A**: 可以！有兩種方式：
1. 將其他人的 Google 帳號加入「測試使用者」（最多 100 個）
2. 將應用程式「發布」（需要 Google 審查）

### Q4: 網頁版和 Android App 會衝突嗎？

**A**: 不會！它們是兩個不同的 OAuth 用戶端：
- 網頁版：網頁應用程式類型
- Android App：Android 類型

兩者可以同時存取同一個 Google Sheets。

### Q5: 如果要部署到網路怎麼辦？

**A**: 更新 OAuth 設定：
1. 前往「憑證」頁面
2. 編輯您的 OAuth 用戶端 ID
3. 在「授權的 JavaScript 來源」加入您的網域
4. 儲存

---

## 📚 下一步

設定完成後：
1. 更新 HTML 檔案（我會幫您建立）
2. 測試 Google 登入
3. 測試讀取/寫入 Google Sheets
4. 開始使用！

---

## 🆘 需要協助？

如果遇到問題：

1. **OAuth 錯誤**
   - 檢查測試使用者是否已加入
   - 檢查授權的 JavaScript 來源是否正確

2. **無法讀取 Sheet**
   - 檢查 Sheet ID 是否正確
   - 檢查 Google 帳號是否有權限存取該試算表

3. **API 配額問題**
   - Google Sheets API 免費配額：每天 300 次讀取 / 100 次寫入
   - 對排班系統來說完全足夠

---

**完成這些設定後，告訴我，我會幫您建立更新後的 HTML 檔案！**

---

**最後更新**: 2025-11-03  
**版本**: 1.0.0



