# 🚨 快速修復：Google OAuth 封鎖錯誤

## 問題

登入時出現：
```
已封鎖存取權：授權錯誤
You can't sign in to this app because it doesn't comply 
with Google's OAuth 2.0 policy
```

---

## 💡 原因

您的 Gmail 帳號（`JosieCrew1987@gmail.com`）沒有被加入為「測試使用者」。

---

## ✅ 解決方法（5 分鐘）

### 步驟 1：開啟 Google Cloud Console

在瀏覽器輸入：
```
https://console.cloud.google.com
```

### 步驟 2：前往 OAuth 同意畫面

```
左側選單
   ↓
「API 和服務」
   ↓
「OAuth 同意畫面」
```

### 步驟 3：加入測試使用者

1. **向下捲動**頁面，找到「測試使用者」區域

2. 點擊 **「+ ADD USERS」** 按鈕

3. 輸入您的 Gmail：
   ```
   JosieCrew1987@gmail.com
   ```

4. 點擊 **「新增」**

5. 點擊 **「儲存」**

### 步驟 4：重新登入

1. 回到您的應用程式：
   ```
   http://localhost:8000/shift_management_system_sheets_full.html
   ```

2. 重新整理頁面（按 **F5**）

3. 點擊「使用 Google 帳號登入」

4. 選擇 `JosieCrew1987@gmail.com`

5. **成功！** ✅

---

## 📸 視覺化流程

```
┌─────────────────────────────────────────┐
│  1. 前往 Google Cloud Console          │
│     console.cloud.google.com            │
└─────────────────────────────────────────┘
                 ↓
┌─────────────────────────────────────────┐
│  2. 左側選單 → API 和服務               │
│              → OAuth 同意畫面           │
└─────────────────────────────────────────┘
                 ↓
┌─────────────────────────────────────────┐
│  3. 向下捲動到「測試使用者」           │
└─────────────────────────────────────────┘
                 ↓
┌─────────────────────────────────────────┐
│  4. 點擊「+ ADD USERS」                 │
└─────────────────────────────────────────┘
                 ↓
┌─────────────────────────────────────────┐
│  5. 輸入：JosieCrew1987@gmail.com      │
└─────────────────────────────────────────┘
                 ↓
┌─────────────────────────────────────────┐
│  6. 點擊「新增」→「儲存」              │
└─────────────────────────────────────────┘
                 ↓
┌─────────────────────────────────────────┐
│  7. 回到應用程式重新登入                │
│     ✅ 完成！                           │
└─────────────────────────────────────────┘
```

---

## ❓ 常見問題

### Q：為什麼會有這個限制？

**A：** 您的應用程式在「測試」模式下，Google 只允許測試使用者登入。這是安全機制。

### Q：需要重新建立 Client ID 嗎？

**A：** 不需要！Client ID 完全不用動，只要加入測試使用者即可。

### Q：可以加入多少測試使用者？

**A：** 最多 100 位。如果需要多人使用，都可以加入。

### Q：多久會生效？

**A：** 通常立即生效，最多等 1-2 分鐘。

### Q：如果我想讓任何人都能登入？

**A：** 需要將應用程式「發布」並通過 Google 審核，但這對個人使用來說太複雜了。建議繼續使用測試模式，將需要的人加入測試使用者即可。

---

## ⚠️ 重要提醒

### ❌ 不需要做的事

- ❌ 不需要重新建立專案
- ❌ 不需要重新建立 Client ID
- ❌ 不需要更改 JavaScript 來源或重新導向 URI
- ❌ 不需要重新啟動伺服器

### ✅ 只需要做的事

- ✅ 在 Google Cloud Console 加入測試使用者
- ✅ 回到應用程式重新登入
- ✅ 就這樣！

---

## 🎯 檢查清單

完成以下步驟，打勾確認：

- [ ] 開啟 Google Cloud Console
- [ ] 前往「OAuth 同意畫面」
- [ ] 找到「測試使用者」區域
- [ ] 點擊「+ ADD USERS」
- [ ] 輸入 `JosieCrew1987@gmail.com`
- [ ] 點擊「新增」和「儲存」
- [ ] 確認看到帳號出現在測試使用者清單
- [ ] 回到應用程式
- [ ] 重新整理頁面（F5）
- [ ] 點擊「使用 Google 帳號登入」
- [ ] 成功登入！✅

---

## 📞 還是不行？

如果按照上述步驟仍然無法登入，請檢查：

1. **確認 Google Cloud Console 中看到測試使用者**
   - 應該顯示：`JosieCrew1987@gmail.com`

2. **確認使用 http://localhost 而非 file://**
   - 網址應該是：`http://localhost:8000/...`

3. **等待幾分鐘**
   - 有時需要 1-2 分鐘讓設定生效

4. **清除瀏覽器快取**
   - Chrome：Ctrl + Shift + Delete
   - 選擇「Cookie 和其他網站資料」
   - 點擊「清除資料」

---

## 📚 延伸閱讀

- [完整故障排除指南](TROUBLESHOOTING_LOGIN.md)
- [Google API 設定指南](WEB_GOOGLE_SHEETS_SETUP.md)
- [快速開始指南](QUICK_START_WEB_SHEETS.md)

---

**最後更新**：2025-11-03  
**問題**：OAuth 2.0 測試使用者限制  
**解決**：加入測試使用者清單

---

**立即修復，5 分鐘搞定！** 🚀



