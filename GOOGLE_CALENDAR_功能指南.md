# 📅 Google 行事曆整合功能指南

**版本**：v6.0.0  
**新增功能**：上傳排班到 Google 行事曆  
**完成日期**：2025-11-03

---

## 🎉 新功能介紹

您現在可以將排班資料**直接上傳到 Google 行事曆**！

### 功能特色

- ✅ **單個上傳** - 點擊按鈕立即上傳單筆排班
- ✅ **批量上傳** - 一次上傳所有排班到行事曆
- ✅ **自動提醒** - 30分鐘前和1天前自動提醒
- ✅ **顏色對應** - 排班顏色自動對應行事曆顏色
- ✅ **完整資訊** - 包含人員、地點、備註等資訊
- ✅ **時區正確** - 自動設定為台灣時區

---

## 🚀 快速開始

### 步驟1：啟用 Google Calendar API

**在 Google Cloud Console 啟用 Calendar API：**

1. 前往 [Google Cloud Console](https://console.cloud.google.com/)
2. 選擇您的專案
3. 左側選單 →「API 和服務」→「已啟用的 API 和服務」
4. 點擊「+ 啟用 API 和服務」
5. 搜尋「Google Calendar API」
6. 點擊「啟用」

**✅ 完成！Calendar API 已啟用。**

---

### 步驟2：重新登入授權

由於新增了 Calendar API 權限，需要重新登入：

```
1. 在系統中點擊「登出」
2. 重新點擊「使用 Google 帳號登入」
3. 授權時會看到新增的權限：
   ✓ 查看及編輯 Google 試算表
   ✓ 管理您的行事曆（新增）⭐
4. 點擊「允許」
```

**注意：** 如果沒有看到行事曆權限，請清除瀏覽器快取後重新登入。

---

### 步驟3：開始使用

#### 方法A：上傳單個排班

```
1. 進入「✏️ 排班管理」頁籤
2. 在排班列表中找到要上傳的排班
3. 點擊該排班的「📅 行事曆」按鈕
4. 等待上傳完成
5. 收到成功訊息！
6. 到 Google 行事曆查看
```

#### 方法B：批量上傳所有排班

```
1. 進入「✏️ 排班管理」頁籤
2. 點擊頂部的「📅 批量上傳行事曆」按鈕
3. 確認要上傳的筆數
4. 等待批量上傳完成（會顯示進度）
5. 查看上傳結果報告
6. 到 Google 行事曆查看所有排班
```

---

## 📱 使用示範

### 單個上傳

**排班資料：**
```
日期：2025-11-15
時間：09:00 - 11:00
單位：台北診所
人員：王醫師, 李醫師
地點：台北市信義區
```

**上傳後在 Google 行事曆顯示為：**
```
標題：台北診所 - 排班
時間：2025-11-15 09:00 - 11:00
地點：台北市信義區
說明：
  人員：王醫師, 李醫師
  備註：（如有）

提醒：
  ⏰ 30分鐘前
  ⏰ 1天前
```

---

### 批量上傳

**假設有50筆排班資料：**

```
點擊「📅 批量上傳行事曆」
  ↓
確認：「確定要將 50 筆排班上傳到 Google 行事曆嗎？」
  ↓
顯示進度：
  ┌──────────────────────────┐
  │ 正在上傳到行事曆...        │
  │                            │
  │        25 / 50            │
  │                            │
  │     請勿關閉視窗           │
  └──────────────────────────┘
  ↓
完成報告：
  ✅ 批量上傳完成！
  
  成功：48 筆
  失敗：2 筆
  
  失敗的排班：
  2025-11-20 新竹診所
  2025-11-25 台北診所
```

---

## 🎨 顏色對應

系統會自動將您的排班顏色對應到 Google 行事曆的顏色：

| 排班顏色 | 行事曆顏色 | 說明 |
|---------|-----------|------|
| 藍色系 | 藍色 (9) | 主要顏色 |
| 綠色系 | 綠色 (2/10) | 醫療相關 |
| 紅色系 | 紅色 (11) | 緊急/重要 |
| 紫色系 | 紫色 (3) | 特殊排班 |
| 黃色系 | 黃色 (5) | 一般排班 |
| 橘色系 | 橘色 (6) | 調整班 |
| 青色系 | 青色 (7) | 備用班 |

---

## ⚙️ 進階設定

### 修改提醒時間

如果您想修改提醒時間（目前為30分鐘和1天前），可以修改程式碼中的設定：

**檔案：** `shift_management_system_sheets_full.html`

**找到：**
```javascript
reminders: {
    useDefault: false,
    overrides: [
        { method: 'popup', minutes: 30 },     // 30分鐘前
        { method: 'popup', minutes: 1440 }    // 1天前
    ]
}
```

**修改為您想要的時間：**
```javascript
reminders: {
    useDefault: false,
    overrides: [
        { method: 'popup', minutes: 60 },     // 1小時前
        { method: 'popup', minutes: 2880 }    // 2天前
    ]
}
```

---

### 修改事件標題格式

**預設格式：** `{事業單位} - 排班`  
**範例：** `台北診所 - 排班`

**如果想修改格式，找到：**
```javascript
summary: `${shift.unit} - 排班`,
```

**修改為：**
```javascript
summary: `${shift.unit} 排班 (${shift.staff})`,  // 加入人員
summary: `[排班] ${shift.unit}`,                 // 改變格式
summary: shift.unit,                             // 只顯示單位名稱
```

---

## ❓ 常見問題

### Q1: 點擊上傳後顯示「權限不足」？

**原因：** 未授權 Calendar API 權限

**解決方法：**
```
1. 確認已在 Google Cloud Console 啟用 Calendar API
2. 點擊「登出」
3. 重新登入並授權行事曆權限
```

---

### Q2: 批量上傳時部分失敗？

**可能原因：**
- 排班資料格式錯誤（如日期或時間格式）
- 網路連線不穩定
- API 請求過多（雖然已有間隔控制）

**解決方法：**
```
1. 查看失敗的排班列表
2. 手動檢查這些排班的資料
3. 修正後重新上傳單個排班
```

---

### Q3: 上傳的事件在行事曆中找不到？

**檢查項目：**
```
✓ 是否選擇了正確的 Google 帳號
✓ 是否查看正確的日期
✓ 是否在「主要」行事曆中查看
✓ 檢查行事曆的「設定」→「匯入和匯出」
```

---

### Q4: 可以上傳到其他行事曆嗎？

**目前狀態：** 只能上傳到「主要」(primary) 行事曆

**如需上傳到其他行事曆：**
1. 需要修改程式碼中的 `calendarId`
2. 或在上傳後手動在 Google 行事曆中移動事件

---

### Q5: 已上傳的事件會重複嗎？

**不會自動去重！**

每次點擊上傳都會建立新的事件，即使之前已上傳過。

**建議：**
- 記錄已上傳的排班
- 或在備註中註明「已上傳」
- 定期清理重複的行事曆事件

---

### Q6: 可以同步刪除嗎？

**目前狀態：** 不支援自動同步刪除

**如需刪除：**
1. 到 Google 行事曆手動刪除
2. 或使用 Google 行事曆的搜尋功能批量刪除

---

## 🔒 隱私與安全

### 權限說明

**系統要求的 Google 權限：**

1. **Google Sheets API**
   - 讀取和寫入您的排班資料

2. **Google Calendar API** ⭐ 新增
   - 在您的行事曆中建立事件
   - 查看您的行事曆

**保證：**
- ✅ 所有資料只儲存在您的 Google 帳號中
- ✅ 不會分享給第三方
- ✅ 不會儲存在其他伺服器
- ✅ 完全由您控制

---

## 💡 使用技巧

### 技巧1：選擇性上傳

```
不要一次批量上傳所有排班！

建議：
1. 先上傳本週或本月的排班
2. 確認正確後再上傳其他排班
3. 避免行事曆過於擁擠
```

### 技巧2：利用顏色分類

```
為不同類型的排班設定不同顏色：
- 藍色：一般排班
- 紅色：緊急排班
- 綠色：備用排班
- 黃色：特殊排班

上傳後在 Google 行事曆中會自動用顏色區分！
```

### 技巧3：備註詳細資訊

```
在排班備註中填寫詳細資訊：
- 聯絡電話
- 注意事項
- 交通方式
- 攜帶物品

這些資訊會自動顯示在行事曆事件中！
```

---

## 🎯 完整使用流程

### 情境：新增一週排班並上傳行事曆

```
步驟1: 規劃排班
  - 在系統中新增本週的5筆排班
  - 設定好時間、人員、地點

步驟2: 檢查排班
  - 在月曆檢視中確認排班正確
  - 檢查有無衝突或錯誤

步驟3: 單個上傳測試
  - 先上傳其中一筆排班
  - 到 Google 行事曆確認格式正確

步驟4: 批量上傳
  - 點擊「批量上傳行事曆」
  - 確認5筆排班
  - 等待上傳完成

步驟5: 確認結果
  - 查看上傳報告
  - 在 Google 行事曆中確認所有排班
  - 設定手機同步自動收到提醒

完成！您現在可以在手機行事曆中看到所有排班了！
```

---

## 📱 手機使用

### 在手機上查看排班

**設定同步：**
```
1. 確保手機已登入相同的 Google 帳號
2. 開啟 Google 行事曆 App
3. 設定 → 帳戶 → 確認「主要」行事曆已同步
4. 所有排班自動顯示在手機行事曆！
```

**提醒通知：**
```
✅ 30分鐘前收到通知
✅ 1天前收到通知
✅ 可在行事曆中查看完整資訊
✅ 一鍵導航到排班地點（如有地址）
```

---

## 🔧 疑難排解

### 問題1：上傳後沒有看到事件

**診斷步驟：**
```
1. F12 打開控制台
2. 查看是否有錯誤訊息
3. 確認API已啟用
4. 確認已授權行事曆權限
5. 重新登入系統
```

### 問題2：批量上傳中斷

**可能原因：**
- 網路斷線
- 瀏覽器分頁關閉
- API 配額限制

**解決方法：**
```
1. 檢查失敗的排班列表
2. 等待1分鐘後重試
3. 分批上傳（每次20-30筆）
```

---

## 📊 版本資訊

**v6.0.0 新功能：**
- ✅ 單個上傳到 Google 行事曆
- ✅ 批量上傳功能
- ✅ 自動顏色對應
- ✅ 提醒設定
- ✅ 進度顯示

**相容性：**
- ✅ 與階段1、階段2功能完全相容
- ✅ 不影響現有排班資料
- ✅ 可選擇性使用

---

## 📚 相關文檔

| 文檔 | 用途 |
|------|------|
| [`GOOGLE_CALENDAR_功能指南.md`](GOOGLE_CALENDAR_功能指南.md) | 本文件 |
| [`PHASE2_COMPLETION.md`](PHASE2_COMPLETION.md) | 階段2功能 |
| [`PHASE1_COMPLETION_SUMMARY.md`](PHASE1_COMPLETION_SUMMARY.md) | 階段1功能 |
| [`WEB_GOOGLE_SHEETS_SETUP.md`](WEB_GOOGLE_SHEETS_SETUP.md) | API 設定指南 |

---

## ✅ 檢查清單

開始使用前請確認：

```
□ 已在 Google Cloud Console 啟用 Calendar API
□ 已重新登入並授權行事曆權限
□ 已測試單個上傳功能
□ 已了解批量上傳的注意事項
□ 已在手機設定同步
```

---

**🎉 恭喜！您現在可以將排班直接同步到 Google 行事曆了！**

**享受更便利的排班管理體驗！** 📅✨🚀

---

**版本**：v6.0.0  
**功能**：Google 行事曆整合  
**狀態**：✅ 完成並可用



