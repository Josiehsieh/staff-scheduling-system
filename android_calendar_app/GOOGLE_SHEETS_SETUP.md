# Google Sheets 排班系統設定指南

本文件說明如何使用 Google Sheets 作為醫療排班系統的資料來源，取代 Supabase。

---

## 📋 目錄

1. [為什麼使用 Google Sheets？](#為什麼使用-google-sheets)
2. [準備 Google Sheets 試算表](#準備-google-sheets-試算表)
3. [設定 Google API](#設定-google-api)
4. [應用程式設定](#應用程式設定)
5. [使用流程](#使用流程)
6. [常見問題](#常見問題)
7. [範本下載](#範本下載)

---

## 為什麼使用 Google Sheets？

### ✅ 優點

- **零成本**：完全免費，無需付費訂閱
- **容易管理**：使用熟悉的試算表介面
- **自動備份**：Google 自動備份所有資料
- **協作功能**：可與其他人共享編輯
- **API 配額充足**：每日 500 次讀取 / 100 次寫入（對每月排班綽綽有餘）
- **與 Google 日曆整合**：無縫同步到手機日曆

### ⚠️ 限制

- **效能**：比資料庫稍慢（約 0.5-2 秒）
- **查詢功能**：無法做複雜的 SQL 查詢
- **適用場景**：適合更新頻率低的場景（如每月排班）

---

## 準備 Google Sheets 試算表

### 步驟 1：建立新的試算表

1. 前往 [Google Sheets](https://sheets.google.com)
2. 點擊「空白」建立新試算表
3. 將試算表命名為「醫療排班資料」（或您喜歡的名稱）

### 步驟 2：設定工作表名稱

將第一個工作表命名為：**排班資料**

### 步驟 3：設定表格欄位

在第一列（標題列）輸入以下欄位：

| A 欄 | B 欄 | C 欄 | D 欄 | E 欄 | F 欄 | G 欄 |
|------|------|------|------|------|------|------|
| 日期 | 開始時間 | 結束時間 | 事業單位 | 人員名單 | 地點 | 顏色 |

#### 欄位說明

1. **日期** (必填)
   - 格式：`YYYY-MM-DD`
   - 範例：`2025-10-20`

2. **開始時間** (必填)
   - 格式：`HH:MM`
   - 範例：`09:00`

3. **結束時間** (必填)
   - 格式：`HH:MM`
   - 範例：`17:00`

4. **事業單位** (必填)
   - 排班的單位名稱
   - 範例：`台北診所`

5. **人員名單** (必填)
   - 多個人員用逗號分隔
   - 範例：`王醫師, 李護理師, 陳護理師`

6. **地點** (選填)
   - 排班地點
   - 範例：`台北市中山區XXX路123號`
   - 如果留空，將使用「事業單位」名稱

7. **顏色** (選填)
   - 事件顏色（十六進位色碼）
   - 範例：`#FF0000`
   - 如果留空，將使用預設顏色 `#667eea`

### 步驟 4：範例資料

以下是完整的範例資料：

```
| 日期       | 開始時間 | 結束時間 | 事業單位   | 人員名單                | 地點                        | 顏色    |
|-----------|---------|---------|-----------|------------------------|----------------------------|---------|
| 2025-10-20| 09:00   | 17:00   | 台北診所   | 王醫師, 李護理師        | 台北市中山區XXX路123號      | #FF5733 |
| 2025-10-20| 13:00   | 21:00   | 新竹診所   | 陳醫師, 張護理師, 林護理師| 新竹市東區YYY路456號        | #33C3FF |
| 2025-10-21| 08:30   | 16:30   | 台中診所   | 黃醫師                  | 台中市西區ZZZ路789號        | #8E44AD |
```

### 步驟 5：取得試算表 ID

1. 開啟您的 Google Sheets
2. 查看瀏覽器網址列的 URL
3. 複製 `/d/` 和 `/edit` 之間的字串，這就是您的 **Sheet ID**

```
https://docs.google.com/spreadsheets/d/【這裡是Sheet ID】/edit
                                      ↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑
```

範例：
```
https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/edit
```
這個例子中，Sheet ID 是：`1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms`

---

## 設定 Google API

### 步驟 1：建立 Google Cloud 專案

1. 前往 [Google Cloud Console](https://console.cloud.google.com/)
2. 點擊「選擇專案」→「新增專案」
3. 輸入專案名稱：`Medical Calendar App`
4. 點擊「建立」

### 步驟 2：啟用 API

1. 在左側選單選擇「API 和服務」→「程式庫」
2. 搜尋並啟用以下 API：
   - **Google Sheets API**
   - **Google Calendar API**

### 步驟 3：設定 OAuth 同意畫面

1. 前往「API 和服務」→「OAuth 同意畫面」
2. 選擇「外部」→「建立」
3. 填寫必要資訊：
   - 應用程式名稱：`醫療行事曆 App`
   - 使用者支援電子郵件：您的 Email
   - 開發人員聯絡資訊：您的 Email
4. 點擊「儲存並繼續」

#### 🔧 新增 API 範圍（重要）

5. 在「範圍」頁面，點擊「新增或移除範圍」
6. **方法一（推薦）**：在搜尋框中直接輸入完整 URL：
   ```
   https://www.googleapis.com/auth/spreadsheets.readonly
   https://www.googleapis.com/auth/calendar
   https://www.googleapis.com/auth/calendar.events
   ```
   - 勾選這些範圍，點擊「更新」

7. **方法二**：如果搜尋不到，可以暫時跳過這步驟
   - Android 應用的範圍會在應用程式代碼中請求
   - 只要代碼設定正確，OAuth 流程會自動處理
   - 點擊「儲存並繼續」直接進入下一步

8. **方法三**：手動在列表中尋找
   - 展開「Google Sheets API v4」→ 勾選 `spreadsheets.readonly`
   - 展開「Google Calendar API」→ 勾選 `calendar` 和 `calendar.events`

9. 在「測試使用者」頁面：
   - 點擊「新增使用者」
   - 輸入您自己的 Google 帳號 Email
   - 點擊「儲存並繼續」

**注意**：如果您的應用保持在「測試」狀態，只有加入「測試使用者」名單的帳號才能使用。

### 步驟 4：建立 OAuth 2.0 用戶端 ID

1. 前往「API 和服務」→「憑證」
2. 點擊「建立憑證」→「OAuth 用戶端 ID」
3. 選擇應用程式類型：「Android」
4. 輸入名稱：`Medical Calendar Android App`
5. 輸入套件名稱：`com.medical.calendar`
6. 取得 SHA-1 憑證指紋：

   在專案根目錄執行：
   ```bash
   # Debug 版本
   keytool -list -v -keystore ~/.android/debug.keystore -alias androiddebugkey -storepass android -keypass android
   
   # Release 版本（如果有的話）
   keytool -list -v -keystore /path/to/your/keystore.jks -alias your_alias_name
   ```

7. 將 SHA-1 指紋貼到欄位中
8. 點擊「建立」

### 步驟 5：下載設定檔

1. 點擊剛建立的憑證
2. 記下「用戶端 ID」（稍後會用到）

---

## 應用程式設定

### 步驟 1：更新設定檔

在應用程式的設定畫面中，輸入以下資訊：

1. **Google Sheet ID**：從上面步驟取得的 Sheet ID
2. **Sheet 範圍**：`排班資料!A2:G`（預設值，表示從第2列開始讀取）

### 步驟 2：Google 帳號登入

1. 開啟應用程式
2. 前往「設定」頁面
3. 點擊「登入 Google 帳號」
4. 選擇您的 Google 帳號
5. 授權應用程式存取權限：
   - 查看 Google 試算表
   - 管理 Google 日曆

### 步驟 3：測試連線

1. 在設定頁面點擊「測試 Google Sheets 連線」
2. 如果成功，會顯示試算表名稱
3. 如果失敗，請檢查：
   - Sheet ID 是否正確
   - Google 帳號是否有權限存取該試算表
   - API 是否已啟用

---

## 使用流程

### 📝 新增/編輯排班資料

1. **在 Google Sheets 中編輯**
   - 直接在試算表中新增或修改排班資料
   - 確保日期和時間格式正確

2. **在應用程式中同步**
   - 開啟應用程式
   - 下拉刷新或點擊「同步」按鈕
   - 應用程式會自動從 Google Sheets 讀取最新資料

### 📅 同步到 Google 日曆

同步流程是自動的：

```
Google Sheets → 應用程式本地資料庫 → Google 日曆 → 手機日曆
```

1. **步驟 1**：從 Google Sheets 讀取排班資料
2. **步驟 2**：儲存到應用程式的本地資料庫（離線可用）
3. **步驟 3**：自動同步到 Google 日曆（會建立「醫療排班」日曆）
4. **步驟 4**：透過 Google 日曆自動同步到手機原生日曆

### 📱 檢視排班

- **在應用程式中**：主畫面顯示當月排班
- **在 Google 日曆中**：查看「醫療排班」日曆
- **在手機日曆中**：所有排班自動顯示

---

## 常見問題

### Q0：無法在 OAuth 同意畫面中新增 API 範圍怎麼辦？

**A**：這是很常見的問題，有以下幾種解決方法：

**方法 1：搜尋完整 URL**
- 在「新增或移除範圍」對話框的搜尋框中
- 輸入完整的 URL，例如：
  ```
  https://www.googleapis.com/auth/spreadsheets.readonly
  ```
- 而不是只輸入 `spreadsheets` 或 `calendar`

**方法 2：直接跳過（推薦給測試階段）**
- 對於 Android 應用，範圍實際上是在應用程式代碼中請求的
- 您可以暫時跳過「範圍」步驟，直接點擊「儲存並繼續」
- 只要確保：
  1. 已啟用 Google Sheets API 和 Google Calendar API
  2. 已建立 OAuth 2.0 用戶端 ID
  3. 在「測試使用者」中加入您的 Google 帳號
- 當您首次在應用程式中登入時，會自動請求這些權限

**方法 3：發布應用（正式使用）**
- 如果應用程式需要給其他人使用
- 完成 OAuth 同意畫面設定後
- 點擊「發布應用程式」
- 然後就可以正常新增範圍

**驗證方法**：
- 即使沒有在 OAuth 同意畫面中手動新增範圍
- 當您在應用程式中首次登入 Google 帳號時
- 應該會看到授權畫面列出：
  - 「查看您的 Google 試算表」
  - 「管理您的日曆」
- 如果看到這些權限請求，表示設定正確！

### Q1：為什麼要從 Supabase 改用 Google Sheets？

**A**：主要原因是成本和使用頻率：
- Supabase 免費版有限制，超過需付費
- 排班資料更新頻率低（通常每月一次）
- Google Sheets 免費且 API 配額充足
- 更容易管理和編輯資料

### Q2：Google Sheets API 有什麼限制？

**A**：每日配額：
- 讀取請求：500 次/天
- 寫入請求：100 次/天

對於每月排班來說完全足夠（每次同步只需 1-2 次 API 請求）。

### Q3：如何處理多人協作？

**A**：Google Sheets 本身支援多人協作：
1. 點擊試算表右上角的「共用」按鈕
2. 輸入協作者的 Email
3. 設定權限（「編輯者」或「檢視者」）
4. 所有人都能即時看到變更

### Q4：如果 Google Sheets 沒有網路可以用嗎？

**A**：應用程式有離線功能：
- 已同步的資料會儲存在本地資料庫
- 離線時仍可查看已同步的排班
- 恢復網路後會自動同步最新資料

### Q5：如何備份資料？

**A**：Google Sheets 自動備份，您也可以：
1. 在 Google Sheets 中點擊「檔案」→「下載」
2. 選擇格式（Excel、CSV 等）
3. 定期下載保存本地備份

### Q6：排班資料會同步到哪些地方？

**A**：資料流向如下：
```
Google Sheets (資料來源)
    ↓
應用程式本地資料庫 (快取)
    ↓
Google 日曆「醫療排班」(雲端日曆)
    ↓
手機原生日曆 (自動同步)
```

### Q7：如何修改已同步的排班？

**A**：直接在 Google Sheets 中修改：
1. 修改試算表中的資料
2. 在應用程式中點擊「同步」
3. 應用程式會自動更新 Google 日曆中的對應事件

### Q8：可以設定提醒嗎？

**A**：可以！排班事件同步到 Google 日曆時會自動設定：
- 提前 1 小時提醒（預設）
- 您也可以在 Google 日曆中手動調整提醒時間

### Q9：如何刪除舊的排班資料？

**A**：兩種方式：
1. **在 Google Sheets 中刪除列**，然後在應用程式中同步
2. **在應用程式中**點擊「清除排班日曆」按鈕（會清除 Google 日曆中的所有排班事件）

### Q10：顏色設定有什麼建議？

**A**：建議使用不同顏色區分不同單位或班別：
- 日班：`#FFD700` (金色)
- 小夜班：`#FF8C00` (橘色)
- 大夜班：`#4169E1` (藍色)
- 台北診所：`#FF5733` (紅色)
- 新竹診所：`#33C3FF` (淺藍)
- 台中診所：`#8E44AD` (紫色)

---

## 範本下載

### 快速開始範本

我們提供了一個預先設定好的範本供您使用：

👉 **[點此複製範本](https://docs.google.com/spreadsheets/d/YOUR_TEMPLATE_ID/copy)**

複製後：
1. 範本會自動複製到您的 Google Drive
2. 按照上面的步驟取得 Sheet ID
3. 在應用程式中設定 Sheet ID
4. 開始使用！

### 範本預覽

範本包含：
- ✅ 正確的欄位設定
- ✅ 範例資料（可直接修改）
- ✅ 資料驗證規則
- ✅ 格式化設定
- ✅ 顏色選擇器（下拉選單）

---

## 技術規格

### API 使用量估算

假設每月排班一次，每次 30 天資料：

| 操作 | 頻率 | API 請求數 | 每月總計 |
|------|------|-----------|---------|
| 讀取排班資料 | 每月 1 次 | 1-2 次 | 1-2 次 |
| 手動刷新 | 每週 1 次 | 1-2 次 | 4-8 次 |
| **每月總計** | - | - | **5-10 次** |

遠低於每日 500 次的限制！

### 效能資訊

- **讀取速度**：約 0.5-2 秒（視網路速度）
- **本地快取**：讀取本地資料 < 0.1 秒
- **同步時間**：30 筆資料約 3-5 秒

---

## 支援與回饋

如有問題或建議，請聯絡：
- Email: your-email@example.com
- GitHub Issues: [專案連結]

---

**最後更新**：2025-10-20
**版本**：2.0.0

---

## 附錄：完整工作流程圖

```
┌─────────────────────────────────────────────────────────────┐
│                     使用者操作流程                            │
└─────────────────────────────────────────────────────────────┘

1. 在 Google Sheets 編輯排班資料
   ↓
2. 開啟應用程式並點擊「同步」
   ↓
3. 應用程式從 Google Sheets 讀取資料
   ↓
4. 資料儲存到本地資料庫（離線可用）
   ↓
5. 自動同步到 Google 日曆的「醫療排班」日曆
   ↓
6. Google 日曆自動同步到手機原生日曆
   ↓
7. 在應用程式、Google 日曆、手機日曆中都能看到排班


┌─────────────────────────────────────────────────────────────┐
│                     資料架構圖                                │
└─────────────────────────────────────────────────────────────┘

┌──────────────────┐
│  Google Sheets   │  ← 資料來源（手動編輯）
│   排班資料表     │
└────────┬─────────┘
         │ (讀取) Google Sheets API
         ↓
┌──────────────────┐
│   Android App    │
│  ┌────────────┐  │
│  │ Room DB    │  │  ← 本地快取（離線可用）
│  │ (SQLite)   │  │
│  └────────────┘  │
└────────┬─────────┘
         │ (寫入) Google Calendar API
         ↓
┌──────────────────┐
│ Google Calendar  │
│  「醫療排班」     │  ← 雲端日曆（多裝置同步）
└────────┬─────────┘
         │ (自動同步)
         ↓
┌──────────────────┐
│   手機原生日曆   │  ← 系統整合（提醒通知）
└──────────────────┘
```

---

**祝您使用愉快！** 🎉


